以下是一份**面向开发者的技术开发说明书（Technical Spec）**，你可以直接提供给 `Cursor` 使用，基于你提供的需求：

---

## 🩺 模块名称：患者信息管理模块（Patient Management Module）

### 📌 功能概述

本模块用于维护患者基本信息，包括患者的增删改查功能（删除为逻辑删除），并支持为指定患者添加一条检查记录，同时自动更新患者的“上次检查时间”与“上次检查信息”。

---

### 📂 数据库设计

#### 1. 患者信息表（`patient_info`）

| 字段名                  | 类型           | 描述           |
| -------------------- | ------------ | ------------ |
| id                   | BIGINT PK    | 患者ID，自增主键    |
| first\_name          | VARCHAR(50)  | 姓（可选）        |
| last\_name           | VARCHAR(50)  | 名（可选）        |
| full\_name           | VARCHAR(100) | 姓名           |
| patient\_code        | VARCHAR(50)  | 编号，唯一        |
| gender               | CHAR(1)      | 性别：M / F / U |
| date\_of\_birth      | DATE         | 出生日期         |
| age                  | BIGINT          | 年龄（可选）       |
| last\_check\_date    | DATE         | 上次检查时间       |
| last\_check\_id | INT         | 上次检查ID     |
| last\_report\_code | INT         | 上次报告编码     |
| is\_deleted          | BOOLEAN      | 是否删除（逻辑删除标记） |
| created\_at          | DATETIME     | 创建时间         |
| updated\_at          | DATETIME     | 更新时间         |

#### 2. 检查记录表（`patient_check_record`）

| 字段名          | 类型           | 描述        |
| ------------ | ------------ | --------- |
| id           | BIGINT PK    | 主键        |
| patient\_id  | BIGINT       | 外键，关联患者ID |
| check\_date  | DATE         | 检查时间      |
| doctor\_name | VARCHAR(100) | 检查医生      |
| report_id      | BIGINT         | 报告ID      |
| report_code | INT         | 报告Code     |
| created\_at  | DATETIME     | 创建时间      |
| updated\_at  | DATETIME     | 更新时间      |

---

### 🎯 接口设计（Controller）

#### 1. 查询患者列表（分页）

* **URL**: `GET /api/patients`
* **请求参数**: page, size, keyword（可选）
* **响应字段**: 患者基本信息列表

#### 2. 查询患者详情

* **URL**: `GET /api/patients/{id}`
* **响应字段**: 患者基本信息 + 检查记录列表（前端可选择是否加载）

#### 3. 新增患者

* **URL**: `POST /api/patients/add`
* **请求体**:

```json
{
  "firstName": "",
  "lastName": "",
  "fullName": "",
  "patientCode": "",
  "gender": "M",
  "dateOfBirth": "1980-01-01",
  "age": 44
}
```

#### 4. 修改患者

* **URL**: `POST /api/patients/edit/{id}`
* **请求体**: 同新增接口字段

#### 5. 删除患者（逻辑删除）

* **URL**: `POST /api/patients/delete/{id}`
* **操作**: 设置 `is_deleted = true`

#### 6. 添加检查记录（新增记录 + 更新患者信息）

service方法

* **逻辑操作**:

  1. 向 `patient_check_record` 表插入记录；
  2. 更新 `patient_info.last_check_date` 和 `last_check_id`，last_report_code。

---

### 🧠 Service 层设计建议

---

### 💡 注意事项

* 所有接口均应校验 `is_deleted = false`
* 年龄字段可以定期通过任务刷新（或从出生日期动态计算）
* 前端在详情页可选择懒加载 `check_record` 列表
* 患者编号 `patient_code` 应全局唯一，可自动生成

---

### ✅ 可选优化
* 患者编号支持按规则生成（如：`P2025070001`）
* 检查记录分页加载接口可加（如 `/api/patients/{id}/check-records?page=1&size=10`）
* 检查医生就是登录人信息
